<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ç¥ç§˜ç¤¼ç‰©</title>
  <style>
    :root{
      --emoji: 'ğŸ–¤âœ¨';
      --overlay: linear-gradient(135deg, rgba(255,255,255,.35), rgba(255,255,255,.15));
      --shadow: 0 10px 30px rgba(0,0,0,.18);
      --fg:#111; --muted:#565; --primary:#6b8afd;

      /* ç»Ÿä¸€å°ºå¯¸ï¼ˆæ›´å°ï¼Œé€‚é…ç«–å±ï¼‰ */
      --bubble-w: clamp(200px, 70vw, 300px);
      --bubble-min-h: clamp(72px, 16vw, 108px);
      --header-h: 44px;
      --radius: 16px;
    }

    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'PingFang SC','Hiragino Sans GB','Microsoft YaHei',Arial,sans-serif;
      background-image: linear-gradient(135deg, #f8fbff 0%, #fff 40%, #f6f7ff 100%);
      background-size: cover;
      background-position: center center;
      background-attachment: fixed;
      overflow:hidden;
    }

    /* é¡¶éƒ¨ HUDï¼ˆè¿›åº¦/é€Ÿç‡/æš‚åœï¼‰ */
    .hud{position:fixed; left:50%; top:12px; transform:translateX(-50%); z-index:3000; display:flex; gap:8px; align-items:center}
    .chip{background:rgba(255,255,255,.9); backdrop-filter:saturate(140%) blur(6px); border:1px solid rgba(0,0,0,.06); color:#111; padding:6px 10px; border-radius:999px; font-size:12px; box-shadow: var(--shadow)}
    .btn{appearance:none; border:none; border-radius:999px; padding:6px 12px; font-size:12px; font-weight:600; background:#2d3a6a; color:#fff; box-shadow:var(--shadow)}

    /* å±…ä¸­å¯åŠ¨å¡ç‰‡ */
    .center-card{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:2000;}
    .card{width:min(92vw,560px); background:rgba(255,255,255,.92); backdrop-filter:saturate(140%) blur(8px); border-radius:18px; box-shadow:var(--shadow); padding:20px; text-align:center}
    .card .gift{font-size:56px}
    .card h1{margin:10px 0 6px; font-size:22px}
    .card p{margin:0; color:#444}
    .card .btn{margin-top:14px}

    /* ç»Ÿä¸€å°ºå¯¸å°å¼¹çª—ï¼ˆä¸ä¼šæ¶ˆå¤±ï¼‰ */
    .bubble{
      position:fixed; display:flex; flex-direction:column;
      width:var(--bubble-w); min-height:var(--bubble-min-h);
      border-radius:var(--radius); box-shadow:var(--shadow); color:#111;
      overflow:hidden; pointer-events:none;
      transform: translate(-50%, -50%);
      will-change: transform, opacity;
      animation: pop-bounce .42s cubic-bezier(.16,.9,.2,1) both;
    }
    .bubble .header{ height:var(--header-h); display:flex; align-items:center; gap:8px; padding:0 12px; background:rgba(255,255,255,.85); backdrop-filter:saturate(140%) blur(6px); border-bottom:1px solid rgba(0,0,0,.06) }
    .bubble .icon{ display:inline-flex; align-items:center; justify-content:center; width:24px; height:24px; border-radius:6px; font-size:18px; line-height:1; }
    .bubble .title{ font-size:14px; font-weight:700; color:#2a2a2a }
    .bubble .body{ flex:1; display:flex; align-items:center; justify-content:center; padding:12px 14px; text-align:center; }
    .bubble .txt{ font-size: clamp(14px, 3.2vw, 18px); font-weight:700; line-height:1.35; text-shadow: 0 1px 0 rgba(255,255,255,.6); word-break: break-word; }

    @keyframes pop-bounce{
      0%   { opacity:0; transform: translate(-50%, -50%) scale(.88); filter:blur(2px); box-shadow: 0 2px 6px rgba(0,0,0,.12) }
      55%  { opacity:1; transform: translate(-50%, -50%) scale(1.06); filter:blur(0); box-shadow: 0 14px 28px rgba(0,0,0,.18) }
      75%  { transform: translate(-50%, -50%) scale(.98) }
      100% { transform: translate(-50%, -50%) scale(1) }
    }

    #fx {
      position: fixed;
      inset: 0;
      z-index: 12000;      /* åœ¨æ‰€æœ‰å¼¹çª—ä¹‹ä¸Š */
      pointer-events: none; /* ä¸æŒ¡ç‚¹å‡» */
    }
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨ HUD -->
  <div class="hud" id="hud" style="display:none;">
    <div class="chip" id="progress" style="display:none;">0 / 100</div> <!-- è®¡æ•°å·²éšè— -->
    <div class="chip" id="rate" style="display:none;">é€Ÿç‡ï¼šâ‰ˆ6/ç§’</div>
    <button class="btn" id="pause">â¸ æš‚åœ</button>
  </div>

  <!-- å±…ä¸­å¯åŠ¨å¡ç‰‡ -->
  <div class="center-card" id="start">
    <div class="card" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
      <div class="dlg-header" style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
        <span class="icon" aria-hidden="true" style="font-size:22px;">ğŸ</span>
        <h1 id="popupTitle" style="margin:0;font-size:20px;">ç¥ç§˜ç¤¼ç‰©</h1>
      </div>
      <p style="margin:4px 0 0;color:#333;font-size:16px;">
        ä½ æœ‰ä¸€ä»½ç¥ç§˜ç¤¼ç‰©å¾…ç­¾æ”¶ï¼Œç¡®å®šè¦æ‰“å¼€å—ï¼Ÿ
      </p>
      <button class="btn" id="startBtn" style="margin-top:16px;">ç¡®å®š</button>
    </div>
  </div>

  <script>
    // ===== å‚æ•° =====
    let TICK_MS  = 350;   // ç”Ÿæˆé—´éš”ï¼ˆæ¯«ç§’ï¼‰
    let PER_TICK = 2;     // æ¯æ¬¡ç”Ÿæˆå¤šå°‘ä¸ªå¼¹çª—
    const KEEP_ALL = true; // å…¨éƒ¨ä¿ç•™ï¼ˆä¸ä¼šç§»é™¤ï¼‰

    // ===== BGMï¼šå¡«æˆä½ æœ¬åœ°åŒç›®å½•/æˆ–çº¿ä¸Šç›´é“¾ =====
    // ä¾‹ï¼šæœ¬åœ°åŒç›®å½•ï¼š "./bgm.mp3"
    //    å­ç›®å½•ï¼š      "./assets/bgm.mp3"
    //    å†…åµŒï¼š        "data:audio/mpeg;base64,......"
    const AUDIO_SRC = "./obj_wo3DlMOGwrbDjj7DisKw_14096426128_d7a9_d197_ef6c_493b534113158f59be669bad52104ca6.mp3";
    const AUDIO_START_AT = 97;  // 1:37
    let audioEl = null;

    // ===== ç¥ç¦æ–‡æ¡ˆï¼ˆç¬¬ 1 æ¡â€œç”Ÿæ—¥å¿«ä¹â€ï¼‰ =====
    const blessings = [
      "ç”Ÿæ—¥å¿«ä¹","æ„¿ä½ æ‰€æ±‚çš†å¦‚æ„¿ï¼Œæ‰€è¡ŒåŒ–å¦é€”","æ–°çš„ä¸€å²ï¼Œçœ¼é‡Œæœ‰å…‰ï¼Œå¿ƒä¸­æœ‰çˆ±","æ„¿ä½ å¥åº·å¸¸åœ¨ï¼Œç¬‘å®¹å¸¸å¼€","å‰ç¨‹ä¼¼é”¦ï¼Œä¸‡äº‹èƒœæ„",
      "ç¥ä½ å­¦ä¸šè¿›æ­¥ï¼Œæ­¥æ­¥é«˜å‡","æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…","æ„¿ä½ å¿ƒæƒ³äº‹æˆï¼Œä¸€åˆ‡é¡ºåˆ©","å²å²å¸¸æ¬¢æ„‰ï¼Œå¹´å¹´çš†èƒœæ„","æ„¿ä½ æ‰€é‡çš†è‰¯å–„ï¼Œæ‰€è§çš†ç¾å¥½",
      "å¥½è¿ä¼´ä½ å·¦å³ï¼Œå¹³å®‰å–œä¹å¸¸åœ¨","äº‹ä¸šè’¸è’¸æ—¥ä¸Šï¼Œç”Ÿæ´»çº¢çº¢ç«ç«","æ„¿ä½ è¢«å…‰ç…§äº®ï¼Œä¹Ÿæˆä¸ºåˆ«äººçš„å…‰","å‰è·¯æœ‰é£æ™¯ï¼Œèº«åæœ‰æ”¯æŒ","é²œèŠ±ä¸æŒå£°éƒ½å‘ä½ æ‹›æ‰‹",
      "æ‰€çˆ±å¦‚å±±æµ·ï¼Œå²æœˆä¸è¨€è´¥","æ„¿ä½ ä¸è´Ÿçƒ­çˆ±ï¼Œä¸è´Ÿè‡ªå·±","ä¸€åˆ‡ç¾å¥½ä¸æœŸè€Œé‡","é˜³å…‰æ­£å¥½ï¼Œä¸‡ç‰©å¯æœŸ","æ„¿ä½ å‹‡æ•¢æ— ç•ï¼Œæ¸©æŸ”åšå®š",
      "çœ‰çœ¼å¸¦ç¬‘ï¼Œå¿ƒäº‹çš†æ™´","æ„¿ä½ æ¯å¤©éƒ½èƒ½ç¡ä¸ªå¥½è§‰","èº«å¿ƒè‡ªç”±ï¼Œçµé­‚æœ‰å…‰","æ„¿ä½ ä¸å¹¸è¿ä¸æœŸè€Œé‡","ç”Ÿæ´»å¯çˆ±ï¼Œå·¥ä½œé¡ºå¿ƒ",
      "æ„¿ä½ æ‹¥æŠ±çƒ­çˆ±ï¼Œæ‹¥æŠ±ä¸–ç•Œ","è¿›æ­¥çœ‹å¾—è§ï¼Œå¹¸ç¦æ‘¸å¾—ç€","æ„¿ä½ è¢«æ—¶é—´æ¸©æŸ”ä»¥å¾…","æ‰€æ„¿çš†å¾—ï¼Œæ‰€å¾—çš†æ¬¢","æ„¿ä½ ä¸å¿«ä¹å¸¸åœ¨",
      "ä¸æƒ§å°†æ¥ï¼Œä¸å¿µè¿‡å¾€","æ„¿ä½ æ°¸è¿œä¿æŒçƒ­çˆ±ä¸å¥½å¥‡","æ˜Ÿæ²³ç¿çƒ‚ï¼Œå‰è·¯æ˜æœ—","æ„¿ä½ å¥½è¿çˆ†æ£šï¼Œå¿ƒæƒ…çˆ†è¡¨","ä¸€è·¯ç”ŸèŠ±ï¼Œæ»¡è½½è€Œå½’",
      "æ„¿ä½ ä¸ç†æƒ³ä¸æœŸè€Œé‡","å¿ƒæœ‰ä¸˜å£‘ï¼Œçœ‰ç›®æˆä¹¦","æ„¿ä½ çš„åŠªåŠ›éƒ½è¢«çœ‹è§","å¿ƒå®‰å³æ˜¯å½’å¤„ï¼Œå¤„å¤„çš†é£æ™¯","æ„¿ä½ ä¸æ¸©æš–æ’ä¸ªæ»¡æ€€",
      "æŠŠå¹³å‡¡æ—¥å­è¿‡æˆè¯—","æ„¿ä½ é€¢è€ƒå¿…è¿‡ï¼Œé€¢æˆ˜å¿…èµ¢","å¿ƒæ€å¹´è½»ï¼Œå¿«ä¹ç¿»å€","æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼ˆå†æ¬¡åº”éªŒï¼‰","é¡ºé£é¡ºæ°´ï¼Œä¹Ÿèƒ½é€†é£é£ç¿”",
      "æ„¿ä½ æ‰€å¿µçš†å¦‚æ„¿ï¼Œæ‰€æ„¿çš†æˆçœŸ","æ¡ƒèŠ±è¿è¿ï¼Œè´µäººå¸¸ä¼´","æ„¿ä½ è´¢æºæ»šæ»šï¼Œä½™é¢å¸¸é’","èº«å¼ºä½“å¥ï¼Œç™¾æ¯’ä¸ä¾µ","æ„¿ä½ ä¸å†ç„¦è™‘ï¼Œç¡é†’å°±æœ‰ç­”æ¡ˆ",
      "æƒ…ç»ªç¨³å®šï¼Œäº‹äº‹é¡ºåˆ©","æ„¿ä½ è¢«çˆ±åŒ…å›´ï¼Œä¹Ÿæ‡‚å¾—è‡ªçˆ±","è„šä¸‹æœ‰è·¯ï¼Œå¿ƒä¸­æœ‰å…‰","æ„¿ä½ ä¸€è·¯æŠ«è†æ–©æ£˜ï¼Œæ‰€å‘æŠ«é¡","è¯»ä¹¦æœ‰æ”¶è·ï¼Œå·¥ä½œæœ‰å›æŠ¥",
      "æ„¿ä½ å¸¸å¸¸è¢«å°äº‹æ„ŸåŠ¨","å’Œè‡ªå·±å’Œè§£ï¼Œå’Œä¸–ç•Œå’Œå¥½","æ„¿ä½ è¿éš¾è€Œä¸Šï¼Œæ‰€é‡çš†ç”œ","ä¸å›°äºå¿ƒï¼Œä¸ä¹±äºæƒ…","æ„¿ä½ ä¸å®¶äººå¹³å®‰å–œä¹",
      "å­¦ä¼šçƒ­çˆ±ï¼Œå­¦ä¼šæ¾å¼›","æ„¿ä½ æ¢¦æƒ³æœ‰ç¿¼ï¼Œç°å®æœ‰ä¾","æŠŠæ—¥å­è¿‡ç”œï¼ŒæŠŠå¿ƒäº‹æ”¾è½»","æ„¿ä½ æµªæ¼«ä¸ç­ï¼Œç†æ€§å¸¸åœ¨","å¿ƒæ€€æ„Ÿæ©ï¼Œæ‰€é‡çš†æ¸©æŸ”",
      "æ„¿ä½ å¤šèµšç‚¹é’±ï¼Œä¹Ÿå¤šä¸€ç‚¹é—²","å’Œè§£è¿‡å»ï¼Œæ‹¥æŠ±æ˜å¤©","æ„¿ä½ é«˜åˆ†è¿‡çº¿ï¼Œé«˜è–ªä¸Šå²¸","æ‰€é‡çš†æ‹ç‚¹ï¼Œæ‹å‘æ›´å¥½","æ„¿ä½ å¥åº·é¥®é£Ÿï¼Œå¿«ä¹è¿åŠ¨",
      "è¿œç¦»å†…è€—ï¼Œé è¿‘çƒ­çˆ±","æ„¿ä½ è¢«å¹¸è¿ç›¯ä¸Šï¼Œè¢«çƒ¦æ¼æ”¾è¿‡","å¸¸å–œå¸¸ä¹ï¼Œæ—¥æ—¥è‡ªå¾—","æ„¿ä½ è¢«åŒä¼´ç†è§£ï¼Œè¢«é•¿è¾ˆç§°èµ","å·¥ä½œä¸åŠ ç­ï¼Œç¡è§‰ä¸å¤±çœ ",
      "æ„¿ä½ åœ¨ä½è°·ä¹Ÿä¸æ”¾å¼ƒ","ç¬‘å®¹æ˜åªšï¼Œå¿ƒå¢ƒæ¾„æ¾ˆ","æ„¿ä½ ä¸å€¼å¾—çš„äººå¹¶è‚©","è¶ŠåŠªåŠ›è¶Šå¹¸è¿","æ„¿ä½ å››å­£å¹³å®‰ï¼Œäº”ç¦ä¸´é—¨",
      "èµ´ä¸€åœºçƒ­çˆ±ï¼Œå½’ä¸€èº«è½»æ¾","æ„¿ä½ æœ‰è¶£æœ‰ç›¼ï¼Œä¸å°†å°±","å­¦æœ‰æ‰€æˆï¼Œè¡Œæœ‰æ‰€æ­¢","æ„¿ä½ å–„è‰¯æœ‰é”‹èŠ’","é£é›¨ä¹‹åè§å½©è™¹",
      "æ„¿ä½ æ‰€ç­‰çš†ä¸è´Ÿæ‰€ç›¼","è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º","æ„¿ä½ æ‰‹æœ‰ä½™é¦™ï¼Œçœ¼æœ‰æ˜Ÿå…‰","ä¸ä¸ºéš¾è‡ªå·±ï¼Œä¸è®¨å¥½ä»–äºº","æ„¿ä½ ä¸ç„¦è™‘è¯´å†è§",
      "çƒ­çˆ±å¯æŠµå²æœˆæ¼«é•¿","æ„¿ä½ æ‰€åšçš†æ‰€çˆ±","è§è¿‡å±±æµ·ï¼Œä»è§‰äººé—´å€¼å¾—","æ„¿ä½ æ˜¥æœ‰ç™¾èŠ±ï¼Œå†¬æœ‰æš–é˜³","åšå–œæ¬¢çš„äº‹ï¼Œå’Œå–œæ¬¢çš„äºº",
      "æ„¿ä½ è¢«å¾®é£è½»æŠšï¼Œè¢«å¥½è¿æ‹¥æŠ±","æ¸…é†’è‡ªå¾‹ï¼Œä¹Ÿæ¸©æŸ”æ¾å¼›","æ„¿ä½ å¼€å£é‡è´µäººï¼Œå‡ºé—¨é€¢å–œäº‹","å¿ƒåº•ä»å®¹ï¼Œæ­¥å±¥è½»ç›ˆ","æ„¿ä½ è½è½å¤§æ–¹ï¼Œé—ªé—ªå‘å…‰",
      "åšæŒä¸å¹¸è¿æ’ä¸ªæ»¡æ€€","æ„¿ä½ æ­¤ç”Ÿå°½å…´ï¼Œèµ¤è¯šå–„è‰¯","ä¸ç•å°†æ¥ï¼Œä¸è´Ÿè¿‡å¾€","æ„¿ä½ è¢«çƒ­çˆ±æ²»æ„ˆï¼Œè¢«ç”Ÿæ´»åçˆ±"
    ];
    while (blessings.length < 100) blessings.push(`æ„¿ä½ å–œä¹å¸¸ä¼´ï¼ˆç¬¬${blessings.length+1}æ¡ï¼‰`);

    // ===== æ ‡é¢˜å›¾æ ‡ï¼ˆä»…ä½¿ç”¨ä½ æŒ‘é€‰çš„å‡ ç§ï¼‰ =====
    const ICON_SETS = [
      [0x1F496],        // ğŸ’–
      [0x1F497],        // ğŸ’—
      [0x1F498],        // ğŸ’˜
      [0x1F49D],        // ğŸ’
      [0x1F496, 0x2728],// ğŸ’–âœ¨
      [0x1F496, 0x1F495]// ğŸ’–ğŸ’•
    ];
    function pickIcon(){
      const set = ICON_SETS[Math.floor(Math.random()*ICON_SETS.length)];
      return String.fromCodePoint(...set);
    }

    // ===== HUD & å¯åŠ¨ =====
    const hud = document.getElementById('hud');
    const progressEl = document.getElementById('progress');
    const rateEl = document.getElementById('rate');
    const pauseBtn = document.getElementById('pause');
    const start = document.getElementById('start');
    const startBtn = document.getElementById('startBtn');

    let timer = null, idx = 0, z = 1000, playing = true, spawned = 0, finished = false;

    startBtn.addEventListener('click', ()=>{
      start.style.display = 'none';
      hud.style.display = 'flex';
      idx = 0; spawned = 0; z = 1000; playing = true; finished = false;
      updateHud();

      // BGMï¼ˆå¤±è´¥ä¹Ÿä¸é˜»å¡ï¼‰
      if (AUDIO_SRC){
        try{
          if (!audioEl){
            audioEl = new Audio(AUDIO_SRC);
            audioEl.loop = true; audioEl.preload = 'auto';
          }
          const seek = ()=>{
            try{
              if (audioEl.readyState > 0){
                audioEl.currentTime = AUDIO_START_AT || 0;
                audioEl.play().catch(()=>{});
                audioEl.removeEventListener('loadedmetadata', seek);
                audioEl.removeEventListener('canplay', seek);
              }
            }catch(e){}
          };
          audioEl.addEventListener('loadedmetadata', seek);
          audioEl.addEventListener('canplay', seek);
          audioEl.play().then(()=>{
            if ((AUDIO_START_AT||0) && audioEl.currentTime < (AUDIO_START_AT-0.5)){
              audioEl.currentTime = AUDIO_START_AT;
            }
          }).catch(()=>{});
        }catch(e){}
      }

      burst();
      startTimer();
    });

    pauseBtn.addEventListener('click', ()=>{
      if (playing){ stopTimer(); pauseBtn.textContent = 'â–¶ ç»§ç»­'; } else { startTimer(); pauseBtn.textContent = 'â¸ æš‚åœ'; }
      playing = !playing;
    });

    function startTimer(){ stopTimer(); timer = setInterval(burst, TICK_MS); }
    function stopTimer(){ if (timer){ clearInterval(timer); timer = null; } }

    function burst(){
      if (finished) return;
      if (idx >= blessings.length){ finish(); return; }
      const remaining = blessings.length - idx;
      const n = Math.min(PER_TICK, remaining);
      for (let k=0; k<n; k++){
        const text = blessings[idx];
        spawnBubble(text, spawned);
        idx++; spawned++;
      }
      updateHud();
      if (idx >= blessings.length){ finish(); }
    }

    function finish(){
      if (finished) return; finished = true;
      stopTimer();
      pauseBtn.disabled = true; rateEl.textContent = 'å·²å®Œæˆ';
      showFinalCard();
    }

    function updateHud(){
      if (progressEl) progressEl.textContent = `${Math.min(idx, blessings.length)} / ${blessings.length}`;
      const perSec = Math.round(1000 / TICK_MS * PER_TICK);
      rateEl.textContent = `é€Ÿç‡ï¼šâ‰ˆ${perSec}/ç§’`;
    }

    // ===== å·¥å…·ï¼šéšæœºæµ…è‰²ã€éšæœºä½ç½® =====
    function pastel(){
      const h = Math.floor(Math.random()*360);
      const s = 55 + Math.random()*18;
      const l = 86 + Math.random()*10;
      return `hsl(${h} ${s}% ${l}%)`;
    }

    function spawnBubble(text, i){
      const wrap = document.createElement('div');
      wrap.className = 'bubble';
      wrap.style.zIndex = (z + i).toString();

      const c1 = pastel(); const c2 = pastel();
      wrap.style.background = Math.random() < 0.55 ? c1 : `linear-gradient(135deg, ${c1} 0%, ${c2} 100%)`;

      // å¤´éƒ¨
      const header = document.createElement('div'); header.className = 'header';
      const icon = document.createElement('div'); icon.className = 'icon'; icon.textContent = pickIcon();
      const title = document.createElement('div'); title.className = 'title'; title.textContent = 'æç¤º';
      header.appendChild(icon); header.appendChild(title);

      // æ­£æ–‡
      const body = document.createElement('div'); body.className = 'body';
      const t = document.createElement('div'); t.className = 'txt'; t.textContent = text;
      body.appendChild(t);

      wrap.appendChild(header); wrap.appendChild(body);
      document.body.appendChild(wrap);

      // è®¡ç®—ä¸è¶Šç•Œä½ç½®ï¼ˆä»¥ä¸­å¿ƒå®šä½ï¼‰
      const pad = 8;
      const w = wrap.offsetWidth; const h = wrap.offsetHeight;
      const ww = window.innerWidth; const wh = window.innerHeight;
      const minX = pad + w/2, maxX = ww - pad - w/2;
      const minY = pad + h/2 + 40, maxY = wh - pad - h/2; // é¡¶éƒ¨ç»™ HUD ç•™ç©ºé—´
      const x = Math.random()*(maxX - minX) + minX;
      const y = Math.random()*(maxY - minY) + minY;
      wrap.style.left = x + 'px';
      wrap.style.top  = y + 'px';
    }

    // â€”â€” ç»“å°¾å¤§å¡ç‰‡ â€”â€” 
    function showFinalCard(){
      const finalMsgs = [
        'ç”Ÿæ—¥å¿«ä¹ å¤è‹±çª<br/>ç»™æœ€å‹‡æ•¢çš„å°å¦–ç²¾',
        'è®°å¾—å¥½å¥½åƒé¥­ è®°å¾—å¤©å¤©å¼€å¿ƒ',
        'å¥½å¥½çˆ±è‡ªå·± ä½ å·²ç»å¾ˆæ£’äº†',
        'ä¸è¦ç†¬å¤œ å¤šå–æ°´å“¦ ä½ è¶…æ£’çš„',
        'è¦ç›¸ä¿¡è‡ªå·±å¥¥ çæƒœæ¯ä¸€åˆ»',
        'åˆ«å¤ªç´¯äº† æœ‰æ—¶å·æ‡’ä¹Ÿå¥½ <br/> æ¯å¤©éƒ½è¦å…ƒæ°”æ»¡æ»¡',
        'å¨ƒå¨ƒè„¸',
        'å¤è‹±çªæ‰€æœ‰çƒ¦æ¼éƒ½æ¶ˆå¤± <br/>ä¸€å®šä¸€å®šè¦æ„Ÿåˆ°å¹¸ç¦',
        'å¤©å†·äº† å¤šç©¿è¡£æœ <br/> å¥½å¥½çˆ±è‡ªå·±',
        'å¤è‹±çªå°æ¶é­”ç”Ÿæ—¥å¿«å¿«ä¹ä¹<br/>â€”â€”æ¥è‡ªè¯—äººçš„ç¥ç¦'
      ];

      const wrap = document.createElement('div');
      wrap.className = 'bubble';
      wrap.style.zIndex = '99999';
      wrap.style.width = 'min(520px, 86vw)';
      wrap.style.minHeight = 'min(260px, 48vh)';
      wrap.style.left = (window.innerWidth/2) + 'px';
      wrap.style.top  = (window.innerHeight/2) + 'px';
      wrap.style.background = 'linear-gradient(135deg, hsl(340 90% 92%), hsl(330 95% 97%))';

      // å¤´éƒ¨
      const header = document.createElement('div'); header.className = 'header';
      const icon = document.createElement('div'); icon.className = 'icon'; icon.textContent = 'ğŸ’–';
      const title = document.createElement('div'); title.className = 'title'; title.textContent = 'ç»ˆæç¥ç¦';
      header.appendChild(icon); header.appendChild(title);

      // æ­£æ–‡
      const body = document.createElement('div'); body.className = 'body';
      const t = document.createElement('div'); t.className = 'txt';
      t.style.fontSize = 'clamp(18px, 5.2vw, 26px)';
      t.style.transition = 'opacity .5s ease';
      t.style.opacity = '0';
      body.appendChild(t);

      wrap.appendChild(header); wrap.appendChild(body);
      document.body.appendChild(wrap);

      // 2 ç§’ä¸€æ¡ï¼Œæ¸éšæ¸ç°
      let i = 0;
      const SHOW_MS = 2000;
      const FADE_MS = 500;

      function showNext(){
        if (i >= finalMsgs.length) return; // æœ€åä¸€æ¡ååœä½
        t.style.opacity = '0';             // æ¸å‡º
        setTimeout(()=>{
          t.innerHTML = finalMsgs[i++];    // æ¢æ–‡æ¡ˆ
          t.style.opacity = '1';           // æ¸å…¥
          setTimeout(()=>{
            if (i < finalMsgs.length) setTimeout(showNext, 0);
          }, SHOW_MS - FADE_MS);
        }, FADE_MS);
      }

      // ç«‹å³æ˜¾ç¤ºç¬¬ä¸€æ¡
      t.innerHTML = finalMsgs[i++];
      t.style.opacity = '1';
      setTimeout(showNext, SHOW_MS);
    }

    function finish(){
      if (finished) return; finished = true;
      stopTimer();
      pauseBtn.disabled = true; rateEl.textContent = 'å·²å®Œæˆ';
      showFinalCard();
      launchFireworks(20); // â¬…ï¸ æ’­æ”¾ 10 ç§’çƒŸèŠ±
    }

    // --- åº†ç¥çƒŸèŠ±ï¼šdurationSec ç§’åè‡ªåŠ¨åœæ­¢ ---
    function launchFireworks(durationSec = 10){
      // åŠ¨æ€åˆ›å»ºç‹¬ç«‹ç”»å¸ƒï¼Œç”¨å®Œå°±åˆ 
      const c = document.createElement('canvas');
      c.style.cssText = 'position:fixed;inset:0;z-index:12000;pointer-events:none';
      document.body.appendChild(c);

      const ctx = c.getContext('2d');
      let W, H, DPR = Math.max(1, window.devicePixelRatio || 1);
      function resize(){
        W = c.clientWidth = window.innerWidth;
        H = c.clientHeight = window.innerHeight;
        c.width  = W * DPR; c.height = H * DPR;
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      resize();
      window.addEventListener('resize', resize);

      const gravity = 0.06;
      const friction = 0.985;
      const particles = [];
      let running = true, rafId = 0;

      function burst(x, y, colors){
        const n = 48 + Math.floor(Math.random()*16);
        for(let i=0;i<n;i++){
          const a = Math.random()*Math.PI*2;
          const sp = 2 + Math.random()*3.5;
          particles.push({
            x, y,
            vx: Math.cos(a)*sp,
            vy: Math.sin(a)*sp,
            life: 1,
            color: colors[Math.floor(Math.random()*colors.length)],
            size: 1 + Math.random()*2
          });
        }
      }

      const palettes = [
        ['#ff7aa2','#ffd1dc','#ffe6a7','#fff5c0'],
        ['#7adfff','#a7ffeb','#ffffff','#c0d9ff'],
        ['#ffd27a','#ff9a7a','#ffe07a','#ffffff']
      ];

      let lastSpawn = 0;
      function loop(t){
        if (!running) return;
        rafId = requestAnimationFrame(loop);

        // ç”¨ destination-out æ“¦å‡ºæ‹–å½±ï¼ˆä¸ä¼šçœŸæ­£ä¸Šé»‘ï¼‰
        ctx.globalCompositeOperation = 'destination-out';
        ctx.fillStyle = 'rgba(0,0,0,0.25)';
        ctx.fillRect(0,0,W,H);

        ctx.globalCompositeOperation = 'lighter';

        // å‘¨æœŸæ€§çˆ†ç‚¸
        if (!lastSpawn || t - lastSpawn > 400){
          lastSpawn = t;
          const px = 0.15*W + Math.random()*0.7*W;
          const py = 0.15*H + Math.random()*0.55*H;
          burst(px, py, palettes[Math.floor(Math.random()*palettes.length)]);
        }

        for (let i=particles.length-1;i>=0;i--){
          const p = particles[i];
          p.vx *= friction; p.vy = p.vy*friction + gravity;
          p.x += p.vx; p.y += p.vy;
          p.life -= 0.012 + Math.random()*0.01;

          if (p.life <= 0 || p.y > H+20){ particles.splice(i,1); continue; }
          ctx.globalAlpha = Math.max(0, p.life);
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
      }
      rafId = requestAnimationFrame(loop);

      // åˆ°æ—¶åœæ­¢å¹¶å½»åº•æ¸…ç†
      setTimeout(()=>{
        running = false;
        cancelAnimationFrame(rafId);
        window.removeEventListener('resize', resize);
        // å¤ä½åˆæˆæ¨¡å¼ï¼Œæ¸…ç©ºç”»å¸ƒï¼Œç„¶åä» DOM ç§»é™¤
        ctx.globalCompositeOperation = 'source-over';
        ctx.clearRect(0,0,W,H);
        c.remove();  // ğŸ”¥ å…³é”®ï¼šåˆ é™¤ç”»å¸ƒ â†’ èƒŒæ™¯ä¸å—å½±å“
      }, durationSec * 1000);
    }

    // å…œåº•ï¼šä»»æ„ç‚¹å‡»ä¹Ÿèƒ½å¯åŠ¨ä¸€æ¬¡
    (function(){
      const btn = document.getElementById('startBtn');
      if(!btn) return;
      let started = false;
      function safeStart(){
        if(started) return; started = true;
        btn.click();
      }
      document.addEventListener('touchstart', safeStart, { once:true, passive:true });
      document.addEventListener('click', safeStart, { once:true });
    })();
  </script>
  <canvas id="fx"></canvas>

</body>
</html>

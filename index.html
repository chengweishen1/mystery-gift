<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>ç¥ç§˜ç¤¼ç‰© Â· èƒŒæ™¯å›¾ + ç»Ÿä¸€å°ºå¯¸å¼¹çª—</title>
  <style>
    :root{
      /* åœ¨è¿™é‡ŒæŠŠå›¾æ¢æˆä½ çš„ï¼šæŠŠ heart.png æ”¾åˆ°å’Œæœ¬æ–‡ä»¶åŒä¸€ç›®å½•ï¼Œæˆ–ä½¿ç”¨ data:URL */
      /* ä½¿ç”¨ç³»ç»ŸåŸç”Ÿ Emojiï¼Œä¸ä¾èµ–å¤–éƒ¨å›¾ç‰‡ */
      --emoji: 'ğŸ–¤âœ¨';   /* èƒŒæ™¯å›¾ï¼ˆå¯æ¢ï¼‰ */

      --overlay: linear-gradient(135deg, rgba(255,255,255,.35), rgba(255,255,255,.15));
      --shadow: 0 10px 30px rgba(0,0,0,.18);
      --fg:#111; --muted:#565; --primary:#6b8afd;

      /* ç»Ÿä¸€å°ºå¯¸ï¼ˆé€‚é…å±å¹•ï¼Œä¿æŒåŒè§„æ¨¡ï¼‰ */
      --bubble-w: clamp(200px, 70vw, 300px);
      --bubble-min-h: clamp(72px, 16vw, 108px);
      --header-h: 44px;
      --radius: 16px;
    }

    html,body{height:100%}
    body{
      margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'PingFang SC','Hiragino Sans GB','Microsoft YaHei',Arial,sans-serif;
      /* å•æ–‡ä»¶ï¼šç”¨æŸ”å’Œæ¸å˜ä»£æ›¿å¤–éƒ¨èƒŒæ™¯å›¾ï¼Œå¯æŒ‰éœ€è°ƒæ•´ */
      background-image: linear-gradient(135deg, #f8fbff 0%, #fff 40%, #f6f7ff 100%);
      background-size: cover;                 /* é€‚é…å„ç§åˆ†è¾¨ç‡ */
      background-position: center center;
      background-attachment: fixed;           /* è§†è§‰æ›´ç¨³ */
      overflow:hidden;                        /* ä¸å‡ºç°æ»šåŠ¨æ¡ */
    }

    /* é¡¶éƒ¨ HUDï¼ˆè¿›åº¦/é€Ÿç‡/æš‚åœï¼‰ */
    .hud{position:fixed; left:50%; top:12px; transform:translateX(-50%); z-index:3000; display:flex; gap:8px; align-items:center}
    .chip{background:rgba(255,255,255,.9); backdrop-filter:saturate(140%) blur(6px); border:1px solid rgba(0,0,0,.06); color:#111; padding:6px 10px; border-radius:999px; font-size:12px; box-shadow: var(--shadow)}
    .btn{appearance:none; border:none; border-radius:999px; padding:6px 12px; font-size:12px; font-weight:600; background:#2d3a6a; color:#fff; box-shadow:var(--shadow)}

    /* å±…ä¸­å¯åŠ¨å¡ç‰‡ */
    .center-card{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:2000;}
    .card{width:min(92vw,560px); background:rgba(255,255,255,.92); backdrop-filter:saturate(140%) blur(8px); border-radius:18px; box-shadow:var(--shadow); padding:20px; text-align:center}
    .card .gift{font-size:56px}
    .card h1{margin:10px 0 6px; font-size:22px}
    .card p{margin:0; color:#444}
    .card .btn{margin-top:14px}

    /* ç»Ÿä¸€å°ºå¯¸å°å¼¹çª—ï¼ˆä¸ä¼šæ¶ˆå¤±ï¼‰ */
    .bubble{ position:fixed; display:flex; flex-direction:column; width:var(--bubble-w); min-height:var(--bubble-min-h); border-radius:var(--radius); box-shadow:var(--shadow); color:#111; overflow:hidden; pointer-events:none; transform: translate(-50%, -50%); will-change: transform, opacity; animation: pop-bounce .42s cubic-bezier(.16,.9,.2,1) both; } }
    .bubble .header{ height:var(--header-h); display:flex; align-items:center; gap:8px; padding:0 12px; background:rgba(255,255,255,.85); backdrop-filter:saturate(140%) blur(6px); border-bottom:1px solid rgba(0,0,0,.06) }
    .bubble .icon{ display:inline-flex; align-items:center; justify-content:center; width:24px; height:24px; border-radius:6px; font-size:18px; line-height:1; }
    .bubble .title{ font-size:14px; font-weight:700; color:#2a2a2a }
    .bubble .body{ flex:1; display:flex; align-items:center; justify-content:center; padding:12px 14px; text-align:center; }
    .bubble .txt{ font-size: clamp(14px, 3.2vw, 18px); font-weight:700; line-height:1.35; text-shadow: 0 1px 0 rgba(255,255,255,.6); word-break: break-word; }

    @keyframes pop-bounce{ 
      0%   { opacity:0; transform: translate(-50%, -50%) scale(.88); filter:blur(2px); box-shadow: 0 2px 6px rgba(0,0,0,.12) }
      55%  { opacity:1; transform: translate(-50%, -50%) scale(1.06); filter:blur(0); box-shadow: 0 14px 28px rgba(0,0,0,.18) }
      75%  { transform: translate(-50%, -50%) scale(.98) }
      100% { transform: translate(-50%, -50%) scale(1) }
    } to{ opacity:1; filter:blur(0) saturate(1);} }
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨ HUD -->
  <div class="hud" id="hud" style="display:none;">
    <div class="chip" id="progress">0 / 100</div>
    <div class="chip" id="rate">é€Ÿç‡ï¼šâ‰ˆ6/ç§’</div>
    <button class="btn" id="pause">â¸ æš‚åœ</button>
  </div>

  <!-- å±…ä¸­å¯åŠ¨å¡ç‰‡ -->
  <div class="center-card" id="start">
    <div class="card">
      <div class="gift">ğŸ</div>
      <h1>ç¥ç§˜ç¤¼ç‰© Â· èƒŒæ™¯å›¾ + ç»Ÿä¸€å°ºå¯¸å¼¹çª—</h1>
      <p>ç‚¹å‡»å¼€å§‹ï¼šåœ¨èƒŒæ™¯å›¾ä¸Šä»¥<strong>ç»Ÿä¸€å¤§å°</strong>ç”Ÿæˆç¥ç¦å¼¹çª—ï¼Œæ¯ä¸ªå¼¹çª—å·¦ä¸Šè§’æœ‰ä½ çš„<strong>çˆ±å¿ƒå›¾æ ‡ + â€œæç¤ºâ€æ ‡é¢˜</strong>ã€‚æ–°å¼¹çª—ä¼šè¦†ç›–æ—§å¼¹çª—ï¼Œæ’­åˆ°<strong>æœ€åä¸€æ¡å³åœæ­¢</strong>ã€‚</p>
      <button class="btn" id="startBtn">æ‰“å¼€ç¤¼ç‰©</button>
    </div>
  </div>

  <script>
    // ===== å‚æ•° =====
    let TICK_MS  = 350;   // ç”Ÿæˆé—´éš”ï¼ˆæ¯«ç§’ï¼‰
    let PER_TICK = 2;     // æ¯æ¬¡ç”Ÿæˆå¤šå°‘ä¸ªå¼¹çª—
    const KEEP_ALL = true; // å…¨éƒ¨ä¿ç•™ï¼ˆä¸ä¼šç§»é™¤ï¼‰

    // ===== BGM é…ç½®ï¼ˆä»»é€‰å…¶ä¸€ï¼šå¤–é“¾/æœ¬åœ°dataURL/ä¸å¡«ï¼‰=====
    // 1) å¤–é“¾ï¼šä¾‹å¦‚ const AUDIO_SRC = "./assets/bgm.mp3";
    // 2) dataURLï¼šæŠŠæ•´é¦–æ­Œè½¬æˆ data:audio/mp3;base64,... è´´åˆ°è¿™é‡Œ
    // 3) ç•™ç©ºï¼šä¸æ’­æ”¾
    const AUDIO_SRC = "https://music.163.com/song?id=1413585838&uct2=U2FsdGVkX18HIjboiilTtfd+FuH1jSj+Op3WZuyrRcQ="; // ğŸ‘‰ ä½ çš„ BGM é“¾æ¥ï¼ˆè‹¥æ— æ³•ç›´é“¾æ’­æ”¾ï¼Œå»ºè®®æ¢æˆå¯ç›´é“¾çš„ mp3/m4aï¼‰
    const AUDIO_START_AT = 97; // ç§’ï¼Œä» 1:37 å¼€å§‹
    let audioEl = null;

    // ===== ç¥ç¦æ–‡æ¡ˆï¼ˆç¬¬ 1 æ¡â€œç”Ÿæ—¥å¿«ä¹â€ï¼‰ =====
    const blessings = [
      "ç”Ÿæ—¥å¿«ä¹","æ„¿ä½ æ‰€æ±‚çš†å¦‚æ„¿ï¼Œæ‰€è¡ŒåŒ–å¦é€”","æ–°çš„ä¸€å²ï¼Œçœ¼é‡Œæœ‰å…‰ï¼Œå¿ƒä¸­æœ‰çˆ±","æ„¿ä½ å¥åº·å¸¸åœ¨ï¼Œç¬‘å®¹å¸¸å¼€","å‰ç¨‹ä¼¼é”¦ï¼Œä¸‡äº‹èƒœæ„",
      "ç¥ä½ å­¦ä¸šè¿›æ­¥ï¼Œæ­¥æ­¥é«˜å‡","æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…","æ„¿ä½ å¿ƒæƒ³äº‹æˆï¼Œä¸€åˆ‡é¡ºåˆ©","å²å²å¸¸æ¬¢æ„‰ï¼Œå¹´å¹´çš†èƒœæ„","æ„¿ä½ æ‰€é‡çš†è‰¯å–„ï¼Œæ‰€è§çš†ç¾å¥½",
      "å¥½è¿ä¼´ä½ å·¦å³ï¼Œå¹³å®‰å–œä¹å¸¸åœ¨","äº‹ä¸šè’¸è’¸æ—¥ä¸Šï¼Œç”Ÿæ´»çº¢çº¢ç«ç«","æ„¿ä½ è¢«å…‰ç…§äº®ï¼Œä¹Ÿæˆä¸ºåˆ«äººçš„å…‰","å‰è·¯æœ‰é£æ™¯ï¼Œèº«åæœ‰æ”¯æŒ","é²œèŠ±ä¸æŒå£°éƒ½å‘ä½ æ‹›æ‰‹",
      "æ‰€çˆ±å¦‚å±±æµ·ï¼Œå²æœˆä¸è¨€è´¥","æ„¿ä½ ä¸è´Ÿçƒ­çˆ±ï¼Œä¸è´Ÿè‡ªå·±","ä¸€åˆ‡ç¾å¥½ä¸æœŸè€Œé‡","é˜³å…‰æ­£å¥½ï¼Œä¸‡ç‰©å¯æœŸ","æ„¿ä½ å‹‡æ•¢æ— ç•ï¼Œæ¸©æŸ”åšå®š",
      "çœ‰çœ¼å¸¦ç¬‘ï¼Œå¿ƒäº‹çš†æ™´","æ„¿ä½ æ¯å¤©éƒ½èƒ½ç¡ä¸ªå¥½è§‰","èº«å¿ƒè‡ªç”±ï¼Œçµé­‚æœ‰å…‰","æ„¿ä½ ä¸å¹¸è¿ä¸æœŸè€Œé‡","ç”Ÿæ´»å¯çˆ±ï¼Œå·¥ä½œé¡ºå¿ƒ",
      "æ„¿ä½ æ‹¥æŠ±çƒ­çˆ±ï¼Œæ‹¥æŠ±ä¸–ç•Œ","è¿›æ­¥çœ‹å¾—è§ï¼Œå¹¸ç¦æ‘¸å¾—ç€","æ„¿ä½ è¢«æ—¶é—´æ¸©æŸ”ä»¥å¾…","æ‰€æ„¿çš†å¾—ï¼Œæ‰€å¾—çš†æ¬¢","æ„¿ä½ ä¸å¿«ä¹å¸¸åœ¨",
      "ä¸æƒ§å°†æ¥ï¼Œä¸å¿µè¿‡å¾€","æ„¿ä½ æ°¸è¿œä¿æŒçƒ­çˆ±ä¸å¥½å¥‡","æ˜Ÿæ²³ç¿çƒ‚ï¼Œå‰è·¯æ˜æœ—","æ„¿ä½ å¥½è¿çˆ†æ£šï¼Œå¿ƒæƒ…çˆ†è¡¨","ä¸€è·¯ç”ŸèŠ±ï¼Œæ»¡è½½è€Œå½’",
      "æ„¿ä½ ä¸ç†æƒ³ä¸æœŸè€Œé‡","å¿ƒæœ‰ä¸˜å£‘ï¼Œçœ‰ç›®æˆä¹¦","æ„¿ä½ çš„åŠªåŠ›éƒ½è¢«çœ‹è§","å¿ƒå®‰å³æ˜¯å½’å¤„ï¼Œå¤„å¤„çš†é£æ™¯","æ„¿ä½ ä¸æ¸©æš–æ’ä¸ªæ»¡æ€€",
      "æŠŠå¹³å‡¡æ—¥å­è¿‡æˆè¯—","æ„¿ä½ é€¢è€ƒå¿…è¿‡ï¼Œé€¢æˆ˜å¿…èµ¢","å¿ƒæ€å¹´è½»ï¼Œå¿«ä¹ç¿»å€","æ„¿ä½ è¢«ä¸–ç•Œæ¸©æŸ”ä»¥å¾…ï¼ˆå†æ¬¡åº”éªŒï¼‰","é¡ºé£é¡ºæ°´ï¼Œä¹Ÿèƒ½é€†é£é£ç¿”",
      "æ„¿ä½ æ‰€å¿µçš†å¦‚æ„¿ï¼Œæ‰€æ„¿çš†æˆçœŸ","æ¡ƒèŠ±è¿è¿ï¼Œè´µäººå¸¸ä¼´","æ„¿ä½ è´¢æºæ»šæ»šï¼Œä½™é¢å¸¸é’","èº«å¼ºä½“å¥ï¼Œç™¾æ¯’ä¸ä¾µ","æ„¿ä½ ä¸å†ç„¦è™‘ï¼Œç¡é†’å°±æœ‰ç­”æ¡ˆ",
      "æƒ…ç»ªç¨³å®šï¼Œäº‹äº‹é¡ºåˆ©","æ„¿ä½ è¢«çˆ±åŒ…å›´ï¼Œä¹Ÿæ‡‚å¾—è‡ªçˆ±","è„šä¸‹æœ‰è·¯ï¼Œå¿ƒä¸­æœ‰å…‰","æ„¿ä½ ä¸€è·¯æŠ«è†æ–©æ£˜ï¼Œæ‰€å‘æŠ«é¡","è¯»ä¹¦æœ‰æ”¶è·ï¼Œå·¥ä½œæœ‰å›æŠ¥",
      "æ„¿ä½ å¸¸å¸¸è¢«å°äº‹æ„ŸåŠ¨","å’Œè‡ªå·±å’Œè§£ï¼Œå’Œä¸–ç•Œå’Œå¥½","æ„¿ä½ è¿éš¾è€Œä¸Šï¼Œæ‰€é‡çš†ç”œ","ä¸å›°äºå¿ƒï¼Œä¸ä¹±äºæƒ…","æ„¿ä½ ä¸å®¶äººå¹³å®‰å–œä¹",
      "å­¦ä¼šçƒ­çˆ±ï¼Œå­¦ä¼šæ¾å¼›","æ„¿ä½ æ¢¦æƒ³æœ‰ç¿¼ï¼Œç°å®æœ‰ä¾","æŠŠæ—¥å­è¿‡ç”œï¼ŒæŠŠå¿ƒäº‹æ”¾è½»","æ„¿ä½ æµªæ¼«ä¸ç­ï¼Œç†æ€§å¸¸åœ¨","å¿ƒæ€€æ„Ÿæ©ï¼Œæ‰€é‡çš†æ¸©æŸ”",
      "æ„¿ä½ å¤šèµšç‚¹é’±ï¼Œä¹Ÿå¤šä¸€ç‚¹é—²","å’Œè§£è¿‡å»ï¼Œæ‹¥æŠ±æ˜å¤©","æ„¿ä½ é«˜åˆ†è¿‡çº¿ï¼Œé«˜è–ªä¸Šå²¸","æ‰€é‡çš†æ‹ç‚¹ï¼Œæ‹å‘æ›´å¥½","æ„¿ä½ å¥åº·é¥®é£Ÿï¼Œå¿«ä¹è¿åŠ¨",
      "è¿œç¦»å†…è€—ï¼Œé è¿‘çƒ­çˆ±","æ„¿ä½ è¢«å¹¸è¿ç›¯ä¸Šï¼Œè¢«çƒ¦æ¼æ”¾è¿‡","å¸¸å–œå¸¸ä¹ï¼Œæ—¥æ—¥è‡ªå¾—","æ„¿ä½ è¢«åŒä¼´ç†è§£ï¼Œè¢«é•¿è¾ˆç§°èµ","å·¥ä½œä¸åŠ ç­ï¼Œç¡è§‰ä¸å¤±çœ ",
      "æ„¿ä½ åœ¨ä½è°·ä¹Ÿä¸æ”¾å¼ƒ","ç¬‘å®¹æ˜åªšï¼Œå¿ƒå¢ƒæ¾„æ¾ˆ","æ„¿ä½ ä¸å€¼å¾—çš„äººå¹¶è‚©","è¶ŠåŠªåŠ›è¶Šå¹¸è¿","æ„¿ä½ å››å­£å¹³å®‰ï¼Œäº”ç¦ä¸´é—¨",
      "èµ´ä¸€åœºçƒ­çˆ±ï¼Œå½’ä¸€èº«è½»æ¾","æ„¿ä½ æœ‰è¶£æœ‰ç›¼ï¼Œä¸å°†å°±","å­¦æœ‰æ‰€æˆï¼Œè¡Œæœ‰æ‰€æ­¢","æ„¿ä½ å–„è‰¯æœ‰é”‹èŠ’","é£é›¨ä¹‹åè§å½©è™¹",
      "æ„¿ä½ æ‰€ç­‰çš†ä¸è´Ÿæ‰€ç›¼","è„šè¸å®åœ°ï¼Œä»°æœ›æ˜Ÿç©º","æ„¿ä½ æ‰‹æœ‰ä½™é¦™ï¼Œçœ¼æœ‰æ˜Ÿå…‰","ä¸ä¸ºéš¾è‡ªå·±ï¼Œä¸è®¨å¥½ä»–äºº","æ„¿ä½ ä¸ç„¦è™‘è¯´å†è§",
      "çƒ­çˆ±å¯æŠµå²æœˆæ¼«é•¿","æ„¿ä½ æ‰€åšçš†æ‰€çˆ±","è§è¿‡å±±æµ·ï¼Œä»è§‰äººé—´å€¼å¾—","æ„¿ä½ æ˜¥æœ‰ç™¾èŠ±ï¼Œå†¬æœ‰æš–é˜³","åšå–œæ¬¢çš„äº‹ï¼Œå’Œå–œæ¬¢çš„äºº",
      "æ„¿ä½ è¢«å¾®é£è½»æŠšï¼Œè¢«å¥½è¿æ‹¥æŠ±","æ¸…é†’è‡ªå¾‹ï¼Œä¹Ÿæ¸©æŸ”æ¾å¼›","æ„¿ä½ å¼€å£é‡è´µäººï¼Œå‡ºé—¨é€¢å–œäº‹","å¿ƒåº•ä»å®¹ï¼Œæ­¥å±¥è½»ç›ˆ","æ„¿ä½ è½è½å¤§æ–¹ï¼Œé—ªé—ªå‘å…‰",
      "åšæŒä¸å¹¸è¿æ’ä¸ªæ»¡æ€€","æ„¿ä½ æ­¤ç”Ÿå°½å…´ï¼Œèµ¤è¯šå–„è‰¯","ä¸ç•å°†æ¥ï¼Œä¸è´Ÿè¿‡å¾€","æ„¿ä½ è¢«çƒ­çˆ±æ²»æ„ˆï¼Œè¢«ç”Ÿæ´»åçˆ±"
    ];
    while (blessings.length < 100) blessings.push(`æ„¿ä½ å–œä¹å¸¸ä¼´ï¼ˆç¬¬${blessings.length+1}æ¡ï¼‰`);

    // ===== æ ‡é¢˜å›¾æ ‡ï¼ˆä»…ä½¿ç”¨ä½ æŒ‘é€‰çš„å‡ ç§ï¼‰ =====
    // ç²‰äº®å¿ƒ ğŸ’–, ç²‰çˆ±å¿ƒ ğŸ’—, ä¸˜æ¯”ç‰¹å¿ƒ ğŸ’˜, ç¼å¸¦å¿ƒ ğŸ’, å¸¦é—ª ğŸ’–âœ¨, å¯çˆ±ç»„åˆ ğŸ’–ğŸ’•
    const ICON_SETS = [
      [0x1F496],
      [0x1F497],
      [0x1F498],
      [0x1F49D],
      [0x1F496, 0x2728],
      [0x1F496, 0x1F495]
    ];
    function pickIcon(){
      const set = ICON_SETS[Math.floor(Math.random()*ICON_SETS.length)];
      return String.fromCodePoint(...set);
    }

    // ===== HUD & å¯åŠ¨ =====
    const hud = document.getElementById('hud');
    const progressEl = document.getElementById('progress'); // è®¡æ•°
    // æŒ‰éœ€éšè—è®¡æ•°
    if (progressEl) progressEl.style.display = 'none';
    const rateEl = document.getElementById('rate');
    const pauseBtn = document.getElementById('pause');
    const start = document.getElementById('start');
    const startBtn = document.getElementById('startBtn');

    let timer = null, idx = 0, z = 1000, playing = true, spawned = 0, finished = false;

    startBtn.addEventListener('click', ()=>{
      start.style.display = 'none';
      hud.style.display = 'flex';
      idx = 0; spawned = 0; z = 1000; playing = true; finished = false;
      updateHud();
      // å‡†å¤‡å¹¶æ’­æ”¾ BGMï¼ˆéœ€è¦ç”¨æˆ·æ‰‹åŠ¿ï¼ŒiOS æ‰èƒ½è‡ªåŠ¨æ’­ï¼‰
      if (AUDIO_SRC){
        if (!audioEl){
          audioEl = new Audio(AUDIO_SRC);
          audioEl.loop = true; audioEl.preload = 'auto';
        }
        const seek = ()=>{
          try{
            if (audioEl.readyState > 0){
              audioEl.currentTime = AUDIO_START_AT || 0;
              audioEl.play().catch(()=>{});
              audioEl.removeEventListener('loadedmetadata', seek);
              audioEl.removeEventListener('canplay', seek);
            }
          }catch(e){}
        };
        audioEl.addEventListener('loadedmetadata', seek);
        audioEl.addEventListener('canplay', seek);
        audioEl.play().then(()=>{
          if ((AUDIO_START_AT||0) && audioEl.currentTime < (AUDIO_START_AT-0.5)){
            audioEl.currentTime = AUDIO_START_AT;
          }
        }).catch(()=>{});
      }
      burst();
      startTimer();
    });

    pauseBtn.addEventListener('click', ()=>{
      if (playing){ stopTimer(); pauseBtn.textContent = 'â–¶ ç»§ç»­'; } else { startTimer(); pauseBtn.textContent = 'â¸ æš‚åœ'; }
      playing = !playing;
    });

    function startTimer(){ stopTimer(); timer = setInterval(burst, TICK_MS); }
    function stopTimer(){ if (timer){ clearInterval(timer); timer = null; } }

    function burst(){
      if (finished) return;
      // ç›´åˆ°æœ€åä¸€ä¸ªç¥ç¦è¯­ï¼Œæ’­æ”¾å®Œå³åœæ­¢ï¼Œå¹¶æ˜¾ç¤ºå¤§ç»“å°¾å¡ç‰‡
      if (idx >= blessings.length){ finish(); return; }
      const remaining = blessings.length - idx;
      const n = Math.min(PER_TICK, remaining);
      for (let k=0; k<n; k++){
        const text = blessings[idx];
        spawnBubble(text, spawned);
        idx++; spawned++;
      }
      updateHud();
      if (idx >= blessings.length){ finish(); }
    }
      const remaining = blessings.length - idx;
      const n = Math.min(PER_TICK, remaining);
      for (let k=0; k<n; k++){
        const text = blessings[idx];
        spawnBubble(text, spawned);
        idx++; spawned++;
      }
      updateHud();
      if (idx >= blessings.length){ finish(); }
    }

    function finish(){
      if (finished) return; finished = true;
      stopTimer();
      pauseBtn.disabled = true; rateEl.textContent = 'å·²å®Œæˆ';
      // ä¸­å¿ƒå¤§ç»“å°¾å¼¹çª—
      showFinalCard();
    }, 1600);
      setTimeout(()=>{ done.remove(); }, 2000);
    }

    function updateHud(){
      progressEl.textContent = `${Math.min(idx, blessings.length)} / ${blessings.length}`;
      const perSec = Math.round(1000 / TICK_MS * PER_TICK);
      rateEl.textContent = `é€Ÿç‡ï¼šâ‰ˆ${perSec}/ç§’`;
    }

    // ===== å·¥å…·ï¼šéšæœºæµ…è‰²ã€éšæœºä½ç½® =====
    function pastel(){
      const h = Math.floor(Math.random()*360);
      const s = 55 + Math.random()*18;  // 55-73% é€‚ä¸­é¥±å’Œ
      const l = 86 + Math.random()*10;  // 86-96% åæµ…
      return `hsl(${h} ${s}% ${l}%)`;
    }
    function rand(min, max){ return Math.random()*(max-min)+min; }

    function spawnBubble(text, i){ /* enhanced pop-in & safe placement */
      const wrap = document.createElement('div');
      wrap.className = 'bubble';
      wrap.style.zIndex = (z + i).toString();

      // ç»Ÿä¸€æµ…è‰²èƒŒæ™¯
      const c1 = pastel(); const c2 = pastel();
      wrap.style.background = Math.random() < 0.55 ? c1 : `linear-gradient(135deg, ${c1} 0%, ${c2} 100%)`;

      // å…ˆæ”¾åˆ°å±å¹•å¤–ä»¥ä¾¿æµ‹é‡å°ºå¯¸
      wrap.style.left = '-9999px'; wrap.style.top = '-9999px';

      // å¤´éƒ¨ï¼šçˆ±å¿ƒå›¾æ ‡ + æ ‡é¢˜â€œæç¤ºâ€
      const header = document.createElement('div'); header.className = 'header';
      const icon = document.createElement('div'); icon.className = 'icon'; icon.textContent = pickIcon();
      const title = document.createElement('div'); title.className = 'title'; title.textContent = 'æç¤º';
      header.appendChild(icon); header.appendChild(title);

      // æ­£æ–‡ï¼šç¥ç¦è¯­
      const body = document.createElement('div'); body.className = 'body';
      const t = document.createElement('div'); t.className = 'txt'; t.textContent = text;
      body.appendChild(t);

      wrap.appendChild(header); wrap.appendChild(body);
      document.body.appendChild(wrap);

      // â€”â€” ç¡®ä¿ä¸ä¼šè¶…å‡ºå±å¹•ï¼šåŸºäºå®é™…åƒç´ è®¡ç®—ä¸­å¿ƒç‚¹èŒƒå›´ â€”â€”
      const pad = 8; // è¾¹è·
      const w = wrap.offsetWidth; const h = wrap.offsetHeight;
      const ww = window.innerWidth; const wh = window.innerHeight;
      const minX = pad + w/2, maxX = ww - pad - w/2;
      const minY = pad + h/2 + 40, maxY = wh - pad - h/2; // é¡¶éƒ¨ç»™ HUD ç•™ç©ºé—´
      const x = Math.random()*(maxX - minX) + minX;
      const y = Math.random()*(maxY - minY) + minY;
      wrap.style.left = x + 'px';
      wrap.style.top  = y + 'px';
    }
      // end pop-in setup
    }
  // â€”â€” ç»“å°¾å¤§å¡ç‰‡ â€”â€”
    function showFinalCard(){
      const wrap = document.createElement('div');
      wrap.className = 'bubble';
      wrap.style.zIndex = (99999).toString();
      wrap.style.width = 'min(520px, 86vw)';
      wrap.style.minHeight = 'min(260px, 48vh)';
      wrap.style.left = (window.innerWidth/2) + 'px';
      wrap.style.top  = (window.innerHeight/2) + 'px';
      wrap.style.background = 'linear-gradient(135deg, hsl(340 90% 92%), hsl(330 95% 97%))';

      const header = document.createElement('div'); header.className = 'header';
      const icon = document.createElement('div'); icon.className = 'icon'; icon.textContent = 'ğŸ’–';
      const title = document.createElement('div'); title.className = 'title'; title.textContent = 'ç»ˆæç¥ç¦';
      header.appendChild(icon); header.appendChild(title);

      const body = document.createElement('div'); body.className = 'body';
      const t = document.createElement('div'); t.className = 'txt';
      t.style.fontSize = 'clamp(18px, 5.2vw, 26px)';
      t.innerHTML = 'ç”Ÿæ—¥å¿«ä¹ å¤è‹±çª<br/>ç»™æœ€å‹‡æ•¢çš„å°å¦–ç²¾';
      body.appendChild(t);

      wrap.appendChild(header); wrap.appendChild(body);
      document.body.appendChild(wrap);
    }
  // === é˜²å¾¡æ€§è¡¥ä¸ï¼šç¡®ä¿â€œæ‰“å¼€ç¤¼ç‰©â€æ€»èƒ½å¯åŠ¨ ===
    (function(){
      const btn = document.getElementById('startBtn');
      if(!btn) return;
      let __started = false;
      function safeStart(){
        if(__started) return; __started = true;
        try{ start.style.display = 'none'; hud.style.display = 'flex'; }catch(e){}
        try{ idx = 0; spawned = 0; z = 1000; playing = true; finished = false; updateHud(); }catch(e){}
        try{ burst(); startTimer(); }catch(e){}
        // å¼‚æ­¥å¯åŠ¨ BGMï¼šå³ä½¿å¤±è´¥ä¹Ÿä¸å½±å“
        if (AUDIO_SRC){
          try{
            if (!audioEl){ audioEl = new Audio(AUDIO_SRC); audioEl.loop = true; audioEl.preload = 'auto'; }
            const seek = ()=>{ try{ if (audioEl.readyState>0){ audioEl.currentTime = AUDIO_START_AT||0; audioEl.play().catch(()=>{}); audioEl.removeEventListener('loadedmetadata', seek); audioEl.removeEventListener('canplay', seek);} }catch(e){} };
            audioEl.addEventListener('loadedmetadata', seek);
            audioEl.addEventListener('canplay', seek);
            audioEl.play().then(()=>{ if ((AUDIO_START_AT||0) && audioEl.currentTime < (AUDIO_START_AT-0.5)) audioEl.currentTime = AUDIO_START_AT; }).catch(()=>{});
          }catch(e){}
        }
      }
      // è¿½åŠ ä¸€æ¬¡æ€§ç›‘å¬ï¼ˆä¸ä¾èµ–åŸæœ‰ç›‘å¬ï¼‰ï¼Œé˜²æ­¢éŸ³é¢‘å¼‚å¸¸é˜»å¡
      btn.addEventListener('click', safeStart, { once:true });
    })();
  // é¢å¤–å…œåº•å¯åŠ¨ï¼ˆé˜²æ­¢ä»»ä½•åŸå› å¯¼è‡´æŒ‰é’®ç›‘å¬å¤±æ•ˆï¼‰
    (function(){
      let started = false;
      function tryStart(){ if (started) return; started = true; const btn = document.getElementById('startBtn'); if (btn) btn.click(); }
      document.addEventListener('touchstart', tryStart, { once:true, passive:true });
      document.addEventListener('click', tryStart, { once:true });
    })();
  </script>
</body>
</html>
